<html>
<!--authored by dimithriavindra@gmail.com
This app is a sample app for travelport locomote recruitment process
-->
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>

<div class="container" style="background-color:lavenderblush;">
    <h1>Travelport Flight Search</h1>
</div>

<div class="container" id="search_container">
    <div class="row">
        <div class = "col-sm-6" style="background-color:lavender;">
            <h3>Search Departures</h3>
            <div class='container' id = 'away_search_pane'>
                Date:<br>
                <input type="date" name="date" id = "away_date"><br>
                From:<br>
                <input type="text" name="from" id = "away_from"><br>
                To:<br>
                <input type="text" name="to" id = "away_to"><br>

                <br>
                <input type="button" class='btn btn-default' id = "subbutton" value="Search" onclick="search_flights('away', 'subbutton')"/>
            </div>
        </div>


        <div class="col-sm-6" style="background-color:lavender;">
            <h3>Search Return Flights</h3>

            <div id = 'return_search_pane'>
                Date:<br>
                <input type="date" name="date" id = "return_date"><br>
                From:<br>
                <input type="text" name="from" id = "return_from"><br>
                To:<br>
                <input type="text" name="to" id = "return_to"><br>

                <br>
                <input type="button" class="btn  btn-default" id = "return_subbutton" onclick="search_flights('return', 'return_subbutton')" value="Search"/>
            </div>
        </div>

    </div>
</div>
<div class="container">
    <div class="row">

        <div class="col-sm-6"  id = 'away_result'></div>
        <div class="col-sm-6" id = 'return_result'></div>

    </div>
</div>

<script type="text/javascript">

    var search_flights= function(pane, btnid){

        var from = $('#'+pane+'_from').val();
        var to = $('#'+pane+'_to').val();
        var date = $('#'+pane+'_date').val();
        var disturl = 'http://localhost:3000/search';
        var $btn = $('#'+btnid);
        $btn.button('loading');

        if (from == ""){
            alert("Starting Airport Cannot Be Empty !");
            $btn.button('reset');

            return;
        }

        if (to == ""){
            alert("Destination Airport Cannot Be Empty !");
            $btn.button('reset');

            return;
        }

        if (date == ""){
            alert("Travel Date Cannot Be Empty !");
            $btn.button('reset');

            return;
        }

        $.getJSON(disturl, {
            date:date,
            from:from,
            to:to
        },function(result){
            appendResults(result, pane+'_result');
            $btn.button('reset');
        }).fail(function(error){
            console.log(error);
            $btn.button('reset');
            handle_error(pane+'_result');
        });



    };

    function handle_error(pane){
        var error_pane = $('#'+pane);
        error_pane.html('Something went wrong! Please Try again. Check your inputs!');

    }


    function appendResults(flight_details, div) {
        var search_results = $('#'+div);
        search_results.html("");
        var count = 0;
        for (var  i = 0; i < flight_details.length; i++){
            var result = flight_details[i];
            for (var j = 0; j<result.length; j++) {
                count ++;
                // writing a basic output of search results. To improve the results, process datetime objects
                // and structure the div containers.
                var innerdiv = $("<a/>", {id:div+'_res_'+count, 'data-toggle':'collapse', href:'#'+div+'_res_panel_'+count});
                var res_panel = $("<div/>", {id:div+'_res_panel_'+count, 'hidden':true, 'class':'collapse'});
                innerdiv.html("<br/>Flight: <b>" +result[j].airline.code +" "+ result[j].flightNum+" </b>     Price:$"+result[j].price+"<br/>");
                res_panel.html("  Airline : " + result[j].airline.name + "<br />");
                res_panel.append("  Start Airport : "+result[j].start.airportName+ "<br/>");
                res_panel.append("  Start City : " + result[j].start.cityName + "<br />");
                var startdate = new Date(result[j].start.dateTime);
                res_panel.append("  Departing Time : " + startdate.toLocaleTimeString(navigator.language, {hour: '2-digit', minute:'2-digit', day :'2-digit', month:'short',year:'numeric'}) + "<br />");
                res_panel.append( "  Finish Airport : " + result[j].finish.airportName + "<br />");
                res_panel.append( "  Finish City : " + result[j].finish.cityName + "<br />");
                var enddate = new Date(result[j].finish.dateTime);
                res_panel.append("  Arriving Time : " + enddate.toLocaleTimeString(navigator.language, {hour: '2-digit', minute:'2-digit', day :'2-digit', month:'short',year:'numeric'}) + "<br />");

                search_results.append(innerdiv);
                search_results.append(res_panel);
            }
        }
    }

</script>

</html>
